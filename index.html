<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#0b1324" />
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <title>9U Draft – iPhone Edition</title>
  <style>
    :root{
      --bg:#0b1324;--bg2:#0f1830;--card:#111a36;--muted:#7f8db3;--text:#eaf0ff;--accent:#4da3ff;--good:#23c552;--warn:#ffbe3d;--bad:#ff6b6b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;letter-spacing:.2px;color:var(--text);background:linear-gradient(180deg,var(--bg),var(--bg2));
    }
    .safe{padding-top:env(safe-area-inset-top);padding-bottom:env(safe-area-inset-bottom)}
    header{
      position:sticky;top:0;z-index:1000;background:rgba(11,19,36,.85);backdrop-filter:blur(8px);
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .bar{display:flex;align-items:center;gap:10px;padding:10px 14px}
    .bar h1{font-size:18px;margin:0;flex:1;font-weight:700}
    .btn{appearance:none;border:none;border-radius:12px;padding:10px 12px;font-weight:700;color:#0c1224;background:var(--accent);box-shadow:0 2px 0 rgba(0,0,0,.25);cursor:pointer}
    .btn:active{transform:translateY(1px)}
    .btn.sec{background:#243158;color:var(--text)}
    .btn.danger{background:var(--bad);color:#1a0b0b}
    .btn.small{padding:8px 10px;border-radius:10px;font-size:12px}
    .grid{display:grid;gap:12px;padding:12px}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.25)}
    .section{padding:12px}
    label{font-size:12px;color:var(--muted)}
    input,select,textarea{width:100%;background:#0c1530;color:var(--text);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px 12px;font-size:16px;outline:none}
    textarea{min-height:64px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (min-width:720px){.row{grid-template-columns:repeat(4,1fr)}}

    .toolbar{display:flex;gap:8px;flex-wrap:wrap}

    .table-wrap{overflow:auto;max-height:70vh;border-top:1px solid rgba(255,255,255,.06)}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px 6px;border-bottom:1px solid rgba(255,255,255,.06);text-align:center;font-size:12px}
    th{position:sticky;top:0;background:#0e1733;z-index:5}
    th.sticky-info, td.sticky-info{position:sticky;left:0;background:linear-gradient(90deg,#0e1733,#0e1733 70%,rgba(14,23,51,0));z-index:6;text-align:left}
    .player-name{font-weight:800}
    .detail{color:var(--muted);font-size:10px}

    .rating{width:36px;height:36px;border-radius:10px;text-align:center;font-weight:800;font-size:14px}
    .r1{background:rgba(255,107,107,.15);border:1px solid rgba(255,107,107,.5)}
    .r2{background:rgba(255,190,61,.16);border:1px solid rgba(255,190,61,.55)}
    .r3{background:rgba(77,163,255,.14);border:1px solid rgba(77,163,255,.55)}
    .r4{background:rgba(35,197,82,.15);border:1px solid rgba(35,197,82,.55)}
    .r5{background:rgba(186,153,255,.16);border:1px solid rgba(186,153,255,.55)}

    .chip{display:inline-block;padding:2px 6px;border-radius:999px;background:#16224a;border:1px solid rgba(255,255,255,.08);font-size:10px;margin:2px}
    .pitch{background:#3b2a00}
    .catch{background:#3a0d12}

    .score{font-weight:900}
    .score.ex{background:rgba(35,197,82,.18)}
    .score.gd{background:rgba(77,163,255,.18)}
    .score.av{background:rgba(255,190,61,.18)}
    .score.bl{background:rgba(255,107,107,.18)}

    footer{padding:12px;color:var(--muted);text-align:center}

    .fab{position:fixed;right:12px;bottom:calc(12px + env(safe-area-inset-bottom));display:flex;gap:8px}
  </style>
</head>
<body class="safe">
  <header class="safe">
    <div class="bar">
      <h1>9U Draft – iPhone</h1>
      <button class="btn small" id="btnInstall" style="display:none">Add to Home</button>
      <button class="btn small sec" id="btnShare" title="Share / Export">Share</button>
    </div>
  </header>

  <div class="grid">
    <div class="card section">
      <div class="toolbar" style="margin-bottom:8px">
        <button class="btn" id="btnAdd">Quick Add Player</button>
        <button class="btn sec" id="btnSave">Save</button>
        <button class="btn sec" id="btnLoad">Load</button>
        <button class="btn sec" id="btnCSV">Export CSV</button>
        <button class="btn danger" id="btnClear">Clear</button>
        <input type="file" id="fileImport" accept=".json,.csv" style="display:none" />
        <button class="btn sec" id="btnImport">Import</button>
      </div>
      <div class="row" style="margin-top:6px">
        <div>
          <label>Player Name</label>
          <input id="newName" placeholder="Player Name" autocomplete="off" />
        </div>
        <div>
          <label>Age</label>
          <input id="newAge" type="number" min="7" max="10" inputmode="numeric" />
        </div>
        <div>
          <label>Size</label>
          <input id="newSize" placeholder="4'2\" / 65lbs" />
        </div>
        <div>
          <label>Experience</label>
          <select id="newExp">
            <option value="">Experience</option>
            <option value="first-year">First Year</option>
            <option value="1-year">1 Year</option>
            <option value="2-years">2 Years</option>
            <option value="3-plus">3+ Years</option>
          </select>
        </div>
      </div>
    </div>

    <div class="card section">
      <div class="row">
        <div>
          <label>Search</label>
          <input id="search" placeholder="Type a name…" />
        </div>
        <div>
          <label>Experience Filter</label>
          <select id="fExp">
            <option value="">All</option>
            <option value="first-year">First Year</option>
            <option value="1-year">1 Year</option>
            <option value="2-years">2 Years</option>
            <option value="3-plus">3+ Years</option>
          </select>
        </div>
        <div>
          <label>Position Focus</label>
          <select id="fPos">
            <option value="">All</option>
            <option value="pitcher">Potential Pitchers</option>
            <option value="catcher">Potential Catchers</option>
          </select>
        </div>
        <div style="display:flex;align-items:flex-end">
          <button class="btn sec" id="btnRank">Draft Rankings</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="table-wrap">
        <table id="tbl">
          <thead>
            <tr>
              <th class="sticky-info">Player</th>
              <th title="Glove Work & Positioning">Glove</th>
              <th title="Footwork & Body Control">Footwork</th>
              <th title="Arm Strength (SS→1B)">Arm</th>
              <th title="Throwing Accuracy">Acc</th>
              <th title="1B Receiving">1B</th>
              <th title="Ball Tracking/Reading">Track</th>
              <th title="Catching Fly Balls">Fly</th>
              <th title="Outfield Arm Strength">OF Arm</th>
              <th title="Throw to 2B Accuracy">OF Acc</th>
              <th title="Batting Stance & Setup">Stance</th>
              <th title="Swing Mechanics">Swing</th>
              <th title="Contact Quality">Contact</th>
              <th title="Base Running Speed">Speed</th>
              <th title="Base Running IQ">BR IQ</th>
              <th title="Pitching Mechanics" class="pitch">P Mech</th>
              <th title="Strike Zone Control" class="pitch">P Ctrl</th>
              <th title="Velocity for Age" class="pitch">P Vel</th>
              <th title="Mound Presence" class="pitch">P Pres</th>
              <th title="Stance & Receiving" class="catch">C Rec</th>
              <th title="Throwing to 2B" class="catch">C Throw</th>
              <th title="Blocking/Framing" class="catch">C Block</th>
              <th title="Leadership/Communication" class="catch">C Lead</th>
              <th title="Effort & Hustle">Effort</th>
              <th title="Coachability">Coach</th>
              <th title="Baseball IQ">IQ</th>
              <th title="Overall Athleticism">Athlet</th>
              <th>Overall</th>
              <th class="sticky-info">Notes</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="body"></tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="fab">
    <button class="btn" id="btnAuto">Auto‑Save: <span id="autoStatus">On</span></button>
  </div>

  <footer>Optimized for iPhone. Works offline. Your data stays on device.</footer>

<script>
(() => {
  const STORAGE_KEY_V2 = '9u-draft-data-v2';
  const STORAGE_KEY_V1 = '9u-draft-data'; // migrate old saves
  let players = [];
  let counter = 0;
  let autoSave = true;
  let saveTimer = null;

  const fundamentals = ['glove','footwork','armStr','accuracy','firstBase','tracking','flyBalls','ofArm','ofAcc','stance','swing','contact','speed','brIQ','effort','coachability','iq','athleticism'];
  const pitchSkills = ['pMech','pCtrl','pVel','pPres'];
  const catchSkills = ['cRec','cThrow','cBlock','cLead'];
  const allSkills = [...fundamentals, ...pitchSkills, ...catchSkills];

  // UI refs
  const els = {
    newName: id('newName'), newAge: id('newAge'), newSize: id('newSize'), newExp: id('newExp'),
    btnAdd: id('btnAdd'), btnSave: id('btnSave'), btnLoad: id('btnLoad'), btnCSV: id('btnCSV'), btnClear: id('btnClear'), btnRank: id('btnRank'),
    btnImport: id('btnImport'), fileImport: id('fileImport'), btnShare: id('btnShare'), btnInstall: id('btnInstall'),
    search: id('search'), fExp: id('fExp'), fPos: id('fPos'), body: id('body'), auto: id('btnAuto'), autoStatus: id('autoStatus')
  };

  function id(x){return document.getElementById(x)}
  function h(html){const t=document.createElement('template');t.innerHTML=html.trim();return t.content.firstElementChild}

  function mkPlayer({name,age,size,experience}){
    return { id: ++counter, name, age: age||'', size: size||'', experience: experience||'', ratings:{}, notes:'' };
  }

  function addRow(p){
    const row = document.createElement('tr');
    row.id = `p-${p.id}`;
    const info = `<div class="player-name">\${esc(p.name)}</div><div class="detail">\${p.age?`Age: \${esc(p.age)}`:''}\${p.size?` · \${esc(p.size)}`:''}\${p.experience?` · \${esc(p.experience)}`:''}</div>`;

    let cells = `<td class="sticky-info" style="min-width:170px">\${info}</td>`;
    allSkills.forEach(sk=>{
      cells += `<td><input type="number" inputmode="numeric" min="1" max="5" class="rating" data-id="\${p.id}" data-skill="\${sk}" /></td>`;
    });

    cells += `<td class="score" id="overall-\${p.id}">0.0</td>`;
    cells += `<td class="sticky-info" style="min-width:180px"><textarea data-id="\${p.id}" class="note" placeholder="Notes…"></textarea></td>`;
    cells += `<td><button class="btn small danger" data-del="\${p.id}">Remove</button></td>`;

    row.innerHTML = cells;
    els.body.appendChild(row);
  }

  function esc(s){return (s||'').toString().replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]))}

  function updateColor(el){
    const v = Number(el.value)||0; el.className = 'rating'; if(v>=1&&v<=5) el.classList.add('r'+v);
  }

  function calcOverall(p){
    let total=0,cnt=0; fundamentals.forEach(sk=>{const v=p.ratings[sk]; if(v>0){total+=v;cnt++}}); return cnt? (total/cnt):0;
  }

  function paintOverall(idp){
    const p = players.find(x=>x.id==idp); if(!p) return; const s=calcOverall(p); const el=id('overall-'+idp);
    if(!el) return; el.textContent=s.toFixed(1); el.className='score';
    if(s>=4) el.classList.add('ex'); else if(s>=3.5) el.classList.add('gd'); else if(s>=2.5) el.classList.add('av'); else if(s>0) el.classList.add('bl');
  }

  function bindRow(idp){
    const row = id('p-'+idp); if(!row) return;
    row.querySelectorAll('input.rating').forEach(inp=>{
      inp.addEventListener('input',e=>{ const el=e.target; const pid=Number(el.dataset.id); const sk=el.dataset.skill; const v=Math.max(1,Math.min(5,Number(el.value)||0)); el.value=v; updateColor(el);
        const p=players.find(x=>x.id===pid); p.ratings[sk]=v; paintOverall(pid); scheduleSave();
      });
      updateColor(inp);
    });
    row.querySelectorAll('textarea.note').forEach(t=>{
      t.addEventListener('input',e=>{ const pid=Number(e.target.dataset.id); const p=players.find(x=>x.id===pid); p.notes=e.target.value; scheduleSave(); });
    });
    row.querySelectorAll('button[data-del]').forEach(b=>{
      b.addEventListener('click',()=>{ if(confirm('Remove this player?')){ players = players.filter(x=>x.id!=idp); row.remove(); scheduleSave(); }});
    });
  }

  function redraw(){ els.body.innerHTML=''; players.forEach(p=>{ addRow(p); bindRow(p.id); paintOverall(p.id);
    // restore values
    allSkills.forEach(sk=>{ const v=p.ratings[sk]; if(v>0){ const inp = document.querySelector(`input[data-id="\${p.id}"][data-skill="\${sk}"]`); if(inp){ inp.value=v; updateColor(inp); } } });
    const note = document.querySelector(`textarea[data-id="\${p.id}"]`); if(note) note.value = p.notes||'';
  }); }

  // Add player
  els.btnAdd.addEventListener('click',()=>{
    const name = els.newName.value.trim(); if(!name){ alert('Enter a player name'); return; }
    const p = mkPlayer({name, age: els.newAge.value, size: els.newSize.value, experience: els.newExp.value});
    players.push(p); addRow(p); bindRow(p.id); paintOverall(p.id); scheduleSave();
    els.newName.value=''; els.newAge.value=''; els.newSize.value=''; els.newExp.value='';
  });

  // Save/Load
  function save(){ const data={{players, counter}}; localStorage.setItem(STORAGE_KEY_V2, JSON.stringify(data)); }
  function loadFrom(key){ const raw=localStorage.getItem(key); if(!raw) return null; try{{ return JSON.parse(raw) }}catch{{ return null }}}
  function load(){ const data = loadFrom(STORAGE_KEY_V2) || loadFrom(STORAGE_KEY_V1); if(data){{ players=data.players||[]; counter=data.counter||0; redraw(); }}}

  function scheduleSave(){ if(!autoSave) return; if(saveTimer) clearTimeout(saveTimer); saveTimer = setTimeout(()=>{{ save(); }}, 600); }

  els.btnSave.addEventListener('click',()=>{ save(); alert('Saved on device'); });
  els.btnLoad.addEventListener('click',()=>{ load(); alert('Loaded'); });
  els.btnClear.addEventListener('click',()=>{ if(confirm('Clear all data?')){{ players=[]; counter=0; redraw(); localStorage.removeItem(STORAGE_KEY_V2); }}});

  // CSV / Share / Import
  function toCSV(){
    let csv = 'Player Name,Age,Size,Experience,';
    csv += fundamentals.join(',')+','+pitchSkills.join(',')+','+catchSkills.join(',')+',';
    csv += 'Overall,Notes\n';
    players.forEach(p=>{
      let line = '"'+p.name.replace(/"/g,'""')+'",'+(p.age||'')+','+(p.size||'')+','+(p.experience||'')+',';
      [...fundamentals,...pitchSkills,...catchSkills].forEach(sk=>{ line += (p.ratings[sk]||'')+','; });
      line += calcOverall(p).toFixed(1)+','+'"'+(p.notes||'').replace(/"/g,'""')+'"\n';
      csv += line;
    });
    return csv;
  }
  function dl(blob,name){ const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=name; document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(url),1000); }

  els.btnCSV.addEventListener('click',()=>{ const csv=toCSV(); dl(new Blob([csv],{type:'text/csv'}),'9u-draft.csv'); });
  els.btnShare.addEventListener('click',async()=>{ const json = JSON.stringify({players,counter},null,2); const file = new File([json],'9u-draft.json',{type:'application/json'});
    if(navigator.share && navigator.canShare && navigator.canShare({files:[file]})){
      try{ await navigator.share({title:'9U Draft Backup', files:[file]}); }catch{}
    }else{ dl(new Blob([json],{type:'application/json'}),'9u-draft.json'); }
  });

  els.btnImport.addEventListener('click',()=> els.fileImport.click());
  els.fileImport.addEventListener('change',async(e)=>{
    const f = e.target.files[0]; if(!f) return; const text = await f.text();
    if(f.name.endsWith('.json')){
      try{ const data = JSON.parse(text); if(Array.isArray(data.players)){ players=data.players; counter=data.counter||players.length; redraw(); save(); alert('Imported JSON'); }}
      catch(err){ alert('Invalid JSON'); }
    } else if(f.name.endsWith('.csv')){
      // minimal CSV import: read name, age, size, experience
      const lines = text.split(/\r?\n/).filter(Boolean); lines.shift();
      players=[]; counter=0;
      lines.forEach(line=>{ const parts = line.split(','); if(parts.length>3){ const p = mkPlayer({name: parts[0].replace(/^\"|\"$/g,'').replace(/\"\"/g,'\"'), age: parts[1], size: parts[2], experience: parts[3]}); players.push(p);} });
      redraw(); save(); alert('Imported CSV (basic)');
    }
    e.target.value='';
  });

  // Filters
  function applyFilters(){
    const q = els.search.value.trim().toLowerCase();
    const fx = els.fExp.value; const fp = els.fPos.value;
    els.body.querySelectorAll('tr').forEach(tr=>{
      const name = tr.querySelector('.player-name')?.textContent.toLowerCase()||'';
      const details = tr.querySelector('.detail')?.textContent.toLowerCase()||'';
      let show=true;
      if(q && !name.includes(q)) show=false;
      if(fx && !details.includes(fx)) show=false;
      if(fp){ /* placeholder for position model */ }
      tr.style.display = show? '' : 'none';
    });
  }
  ['input','change','keyup'].forEach(ev=>{ els.search.addEventListener(ev,applyFilters); els.fExp.addEventListener(ev,applyFilters); els.fPos.addEventListener(ev,applyFilters); });

  // Rankings
  els.btnRank.addEventListener('click',()=>{
    const ranked = players.map(p=>({
      ...p,
      overall: Number(calcOverall(p).toFixed(1)),
      pitch: avg(p, pitchSkills),
      catch: avg(p, catchSkills)
    })).sort((a,b)=>b.overall-a.overall);
    let out = 'DRAFT RANKINGS\n\nOverall:\n'; ranked.forEach((p,i)=> out += `${i+1}. ${p.name} – ${p.overall}\n`);
    const tp = ranked.filter(p=>p.pitch>0).sort((a,b)=>b.pitch-a.pitch).slice(0,8);
    const tc = ranked.filter(p=>p.catch>0).sort((a,b)=>b.catch-a.catch).slice(0,5);
    out += '\nTop Pitchers:\n'+tp.map((p,i)=>`${i+1}. ${p.name} – ${p.pitch.toFixed(1)}`).join('\n');
    out += '\n\nTop Catchers:\n'+tc.map((p,i)=>`${i+1}. ${p.name} – ${p.catch.toFixed(1)}`).join('\n');
    const w=window.open('', '_blank'); w.document.write(`<pre style="font-family:ui-monospace,Menlo,monospace;padding:16px">${out}</pre>`);
  });
  function avg(p,skills){ let t=0,c=0; skills.forEach(s=>{const v=p.ratings[s]; if(v>0){t+=v;c++;}}); return c? t/c : 0; }

  // Auto‑save
  els.auto.addEventListener('click',()=>{ autoSave=!autoSave; els.autoStatus.textContent = autoSave? 'On' : 'Off'; if(autoSave) scheduleSave(); });
  window.addEventListener('beforeunload',()=>{ try{ save(); }catch{} });

  // PWA: service worker registration & install prompt
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./service-worker.js').catch(()=>{});
    });
  }
  // iOS A2HS hint (manual)
  let deferredPrompt=null; window.addEventListener('beforeinstallprompt', (e)=>{ e.preventDefault(); deferredPrompt=e; document.getElementById('btnInstall').style.display='inline-flex'; });
  document.getElementById('btnInstall').addEventListener('click', async()=>{ if(deferredPrompt){ deferredPrompt.prompt(); await deferredPrompt.userChoice; } else { alert('On iPhone: Share → Add to Home Screen'); } });

  // Init
  load();
})();
</script>
</body>
</html>
